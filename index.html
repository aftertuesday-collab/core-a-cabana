<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Core-a-Cabana Challenge</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        :root { --aqua: #00e5ff; --coral: #ff7e5f; --sunny: #feb47b; --pink: #ff4081; --palm: #2e7d32; --v1: #ff9e22; --v2: #4db6ac; --v3: #9575cd; --v4: #f06292; }
        body { font-family: 'Avenir Next', sans-serif; background: linear-gradient(180deg, #00b4db 0%, #ff7e5f 100%); background-attachment: fixed; color: #fff; margin: 0; min-height: 100vh; display: flex; flex-direction: column; align-items: center; overflow-x: hidden; }
        .sun-bg { position: fixed; top: 10%; left: 50%; transform: translateX(-50%); width: 150px; height: 150px; background: #fff7e6; border-radius: 50%; box-shadow: 0 0 80px #feb47b; z-index: -1; animation: glow 4s infinite alternate; }
        @keyframes glow { from { transform: translateX(-50%) scale(1); opacity: 0.6; } to { transform: translateX(-50%) scale(1.15); opacity: 0.9; } }
        #join-overlay { position: fixed; inset: 0; background: linear-gradient(180deg, #00b4db 0%, #ff7e5f 100%); z-index: 3000; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 30px; text-align: center; }
        .join-btn { padding: 18px 40px; border-radius: 35px; border: none; background: var(--pink); color: white; font-weight: bold; cursor: pointer; box-shadow: 0 10px 25px rgba(255,64,129,0.4); }
        .tab-bar { position: fixed; bottom: 0; width: 100%; max-width: 450px; background: rgba(255,255,255,0.15); display: flex; justify-content: space-around; padding: 15px 0; border-radius: 30px 30px 0 0; z-index: 1000; backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.2); }
        .tab-btn { background: none; border: none; font-size: 0.8rem; font-weight: 800; color: #fff; opacity: 0.6; }
        .tab-btn.active { opacity: 1; border-bottom: 3px solid #fff; }
        .page { display: none; width: 100%; max-width: 400px; padding: 25px 25px 150px; box-sizing: border-box; }
        .page.active { display: block; }
        .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .day-box { aspect-ratio: 1/1; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 15px; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer; backdrop-filter: blur(5px); }
        .day-box.complete { border-color: transparent; }
        .leader-row { background: rgba(255,255,255,0.15); padding: 15px; border-radius: 20px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border: 1px solid rgba(255,255,255,0.1); }
        #hype-toast { position: fixed; top: 20px; width: 85%; max-width: 350px; background: #fff; color: #333; padding: 15px; border-radius: 20px; z-index: 4000; display: none; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3); animation: slideIn 0.5s; }
        @keyframes slideIn { from { transform: translateY(-100px); } to { transform: translateY(0); } }
        .hype-wall { background: rgba(255,255,255,0.1); padding: 15px; border-radius: 20px; margin-top: 20px; max-height: 200px; overflow-y: auto; }
        .hype-msg { font-size: 0.8rem; padding: 5px 0; border-bottom: 1px solid rgba(255,255,255,0.1); }
        #modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 30px; z-index: 2100; width: 85%; max-width: 320px; text-align: center; color: #333; }
        #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2050; backdrop-filter: blur(5px); }
    </style>
</head>
<body>
    <div class="sun-bg"></div>
    <div id="hype-toast"></div>

    <div id="join-overlay">
        <h1 style="font-size: 3rem;">üçπ</h1>
        <h1>Core-a-Cabana</h1>
        <input type="text" id="user-name" placeholder="Enter Your Name" style="padding:15px; border-radius:15px; border:none; width:80%; text-align: center; margin-bottom: 20px;">
        <button class="join-btn" onclick="joinChallenge()">START THE CHALLENGE üå¥</button>
    </div>

    <div id="dashboard" class="page active">
        <h1 style="text-align: center;">My Progress ü••</h1>
        <div class="grid" id="challenge-grid"></div>
    </div>

    <div id="friends" class="page">
        <h1>üèÜ Squad Hype</h1>
        <div id="friends-list"></div>
        <div class="hype-wall" id="hype-wall">
            <p style="font-size: 0.7rem; opacity: 0.7; margin-bottom: 5px;">SQUAD CHAT</p>
            <div id="chat-messages"></div>
        </div>
        <div style="display:flex; margin-top:10px;">
            <input type="text" id="chat-input" placeholder="Send some hype..." style="flex:1; padding:10px; border-radius:10px; border:none;">
            <button onclick="sendHype()" style="background:var(--aqua); border:none; padding:10px; border-radius:10px; margin-left:5px;">üî•</button>
        </div>
    </div>

    <div id="overlay" onclick="closeModal()"></div>
    <div id="modal">
        <h2 style="margin-top:0">Workout Log üçç</h2>
        <select id="video-select" style="width:100%; padding:15px; margin-bottom:20px; border-radius:15px;">
            <option value="v1">7m Dumbbell Abs</option>
            <option value="v2">10m Lower Abs</option>
            <option value="v3">10m Advanced Abs</option>
            <option value="v4">8m Standing Abs</option>
        </select>
        <button class="join-btn" style="width:100%;" onclick="markComplete()">LOG WORKOUT üå¥</button>
    </div>

    <div class="tab-bar">
        <button class="tab-btn active" onclick="showPage('dashboard', this)">HOME üèùÔ∏è</button>
        <button class="tab-btn" onclick="showPage('friends', this)">SQUAD üèÜ</button>
    </div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyCNXn3jKb1xRpHVqZcBy9fEPFjxy_drl_Y", authDomain: "core-a-cabana.firebaseapp.com", projectId: "core-a-cabana", storageBucket: "core-a-cabana.firebasestorage.app", messagingSenderId: "914813550096", appId: "1:914813550096:web:1fdc8e9486b46f0ad09495" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        let myName = localStorage.getItem('cabanaName');
        let myWorkouts = JSON.parse(localStorage.getItem('cabanaWorkouts')) || {};
        let selectedDayKey = null;

        if(myName) document.getElementById('join-overlay').style.display = 'none';

        function joinChallenge() {
            const name = document.getElementById('user-name').value.trim();
            if(!name) return;
            myName = name;
            localStorage.setItem('cabanaName', name);
            document.getElementById('join-overlay').style.display = 'none';
            db.collection("players").doc(myName).set({ name: myName, count: 0, lastUpdate: Date.now() });
        }

        function init() {
            const grid = document.getElementById('challenge-grid'); grid.innerHTML = '';
            for (let i = 0; i < 32; i++) {
                const date = new Date(2026, 0, 3 + i); const key = date.toDateString(); const type = myWorkouts[key];
                const box = document.createElement('div'); box.className = `day-box ${type ? 'complete' : ''}`;
                if(type) box.style.background = 'var(--pink)';
                box.innerHTML = `<div style="font-weight:bold;">${date.getDate()}</div>${type ? 'üå¥' : ''}`;
                box.onclick = () => { selectedDayKey = key; openModal(); };
                grid.appendChild(box);
            }
        }

        function markComplete() {
            myWorkouts[selectedDayKey] = true;
            localStorage.setItem('cabanaWorkouts', JSON.stringify(myWorkouts));
            const total = Object.keys(myWorkouts).length;
            db.collection("players").doc(myName).set({ name: myName, count: total, lastUpdate: Date.now(), alert: true }, {merge:true});
            db.collection("chat").add({ text: `üéâ Congratulate ${myName} for completing workout #${total}!`, time: Date.now() });
            confetti({ particleCount: 150, spread: 70 }); closeModal(); init();
        }

        function sendHype() {
            const txt = document.getElementById('chat-input').value;
            if(!txt) return;
            db.collection("chat").add({ text: `üî• ${myName}: ${txt}`, time: Date.now() });
            document.getElementById('chat-input').value = '';
        }

        db.collection("players").onSnapshot(snap => {
            const list = document.getElementById('friends-list'); list.innerHTML = '';
            snap.forEach(doc => {
                const p = doc.data();
                if(p.name !== myName && p.alert && (Date.now() - p.lastUpdate < 5000)) {
                    showHypeToast(`üéâ Hype up ${p.name}! Just finished a workout!`);
                    db.collection("players").doc(p.name).update({alert: false});
                }
                list.innerHTML += `<div class="leader-row"><span>üèùÔ∏è ${p.name}</span><b>${p.count}/32</b></div>`;
            });
        });

        db.collection("chat").orderBy("time", "desc").limit(10).onSnapshot(snap => {
            const chat = document.getElementById('chat-messages'); chat.innerHTML = '';
            snap.forEach(doc => { chat.innerHTML += `<div class="hype-msg">${doc.data().text}</div>`; });
        });

        function showHypeToast(msg) {
            const t = document.getElementById('hype-toast');
            t.innerHTML = `<b>SQUAD ALERT</b><br>${msg}<br><button onclick="sendHypeEmoji('üî•')" style="margin-top:10px; border:none; background:none; font-size:1.5rem;">üî•</button><button onclick="sendHypeEmoji('ü••')" style="border:none; background:none; font-size:1.5rem;">ü••</button>`;
            t.style.display = 'block'; setTimeout(() => t.style.display = 'none', 8000);
        }

        function sendHypeEmoji(e) { db.collection("chat").add({ text: `${myName} sent a ${e} to the squad!`, time: Date.now() }); }
        function openModal() { document.getElementById('modal').style.display='block'; document.getElementById('overlay').style.display='block'; }
        function closeModal() { document.getElementById('modal').style.display='none'; document.getElementById('overlay').style.display='none'; }
        function showPage(id, btn) { document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active')); document.getElementById(id).classList.add('active'); btn.classList.add('active'); }
        init();
    </script>
</body>
</html>
