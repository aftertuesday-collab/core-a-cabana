<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Core-a-Cabana Challenge</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --aqua: #00e5ff; --coral: #ff7e5f; --sunny: #feb47b; --pink: #ff4081; --palm: #2e7d32;
            --v1: #ff9e22; --v2: #4db6ac; --v3: #9575cd; --v4: #f06292;
        }

        body {
            font-family: 'Avenir Next', 'Helvetica Neue', sans-serif;
            background: linear-gradient(-45deg, #00e5ff, #ff7e5f, #feb47b, #72ffb2);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
            color: #fff; margin: 0; min-height: 100vh; display: flex; flex-direction: column; align-items: center;
        }

        @keyframes gradient { 0% {background-position: 0% 50%;} 50% {background-position: 100% 50%;} 100% {background-position: 0% 50%;} }

        #notification-toast {
            position: fixed; top: 20px; background: rgba(255,255,255,0.9); padding: 12px 25px; border-radius: 30px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2); z-index: 2000; display: none; border: 2px solid var(--pink);
            font-weight: bold; color: var(--pink); animation: slideDown 0.5s; backdrop-filter: blur(5px);
        }

        @keyframes slideDown { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .tab-bar {
            position: fixed; bottom: 0; width: 100%; max-width: 450px; background: rgba(255,255,255,0.2);
            display: flex; justify-content: space-around; padding: 15px 0; border-radius: 30px 30px 0 0;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1); z-index: 1000; backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.3);
        }
        .tab-btn { background: none; border: none; font-size: 0.85rem; font-weight: 800; color: #fff; cursor: pointer; text-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .tab-btn.active { color: #fff; border-bottom: 4px solid #fff; padding-bottom: 5px; }

        .page { display: none; width: 100%; max-width: 400px; padding: 25px; padding-bottom: 120px; box-sizing: border-box; }
        .page.active { display: block; animation: slideUp 0.4s ease-out; }

        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
        .day-box {
            aspect-ratio: 1/1; background: rgba(255, 255, 255, 0.2); border: 2px solid rgba(255,255,255,0.4);
            border-radius: 20px; display: flex; flex-direction: column; justify-content: center;
            align-items: center; cursor: pointer; transition: 0.3s; backdrop-filter: blur(5px);
        }
        .day-box:hover { transform: scale(1.05); background: rgba(255, 255, 255, 0.3); }
        .day-box.complete { border-color: transparent; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .day-box.v1 { background: linear-gradient(135deg, #ff9e22, #ff6d00); }
        .day-box.v2 { background: linear-gradient(135deg, #4db6ac, #00897b); }
        .day-box.v3 { background: linear-gradient(135deg, #9575cd, #5e35b1); }
        .day-box.v4 { background: linear-gradient(135deg, #f06292, #d81b60); }
        .day-box .check { font-size: 1.5rem; display: none; } .day-box.complete .check { display: block; }
        .day-box .day-num { font-weight: bold; font-size: 0.9rem; margin-top: 4px; }

        .friend-row { background: rgba(255,255,255,0.2); padding: 18px; border-radius: 20px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; border: 1px solid rgba(255,255,255,0.3); backdrop-filter: blur(10px); }

        #join-overlay { position: fixed; inset: 0; background: linear-gradient(135deg, var(--aqua), var(--coral)); z-index: 3000; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; padding: 30px; text-align: center; }
        
        .video-card { background: rgba(255,255,255,0.9); padding: 20px; border-radius: 25px; margin-bottom: 15px; border-left: 10px solid var(--aqua); color: #333; }
        .btn { padding: 18px; border: none; border-radius: 20px; font-weight: bold; cursor: pointer; width: 100%; font-size: 1.1rem; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        
        #modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 30px; z-index: 1100; width: 85%; max-width: 320px; text-align: center; color: #333; }
        #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); z-index: 1050; backdrop-filter: blur(8px); }
        
        .hydration-card { background: rgba(255,255,255,0.2); padding: 25px; border-radius: 30px; margin-top: 30px; text-align: center; border: 1px solid rgba(255,255,255,0.3); backdrop-filter: blur(10px); }
    </style>
</head>
<body>

    <div id="notification-toast"></div>

    <div id="join-overlay">
        <h1 style="font-size: 3.5rem; margin-bottom: 0;">üèùÔ∏è</h1>
        <h1 style="font-size: 2.2rem; margin-top: 0; text-shadow: 0 4px 10px rgba(0,0,0,0.2);">Core-a-Cabana</h1>
        <p style="font-size: 1.2rem; opacity: 0.9;">Paradise is just 32 days away.</p>
        <input type="text" id="user-name" placeholder="Enter Your Name" style="padding:18px; border-radius:20px; border:none; width:80%; font-size: 1.1rem; margin: 25px 0; box-shadow: 0 10px 20px rgba(0,0,0,0.1);">
        <button onclick="joinChallenge()" style="padding:18px 50px; border-radius:35px; border:none; background:var(--pink); color:white; font-weight:bold; font-size: 1.2rem; cursor: pointer; box-shadow: 0 10px 25px rgba(255,64,129,0.4);">ENTER THE CABANA üå¥</button>
    </div>

    <div id="dashboard" class="page active">
        <div style="text-align: center; margin-bottom: 25px;">
            <h1 style="font-size: 2.2rem; margin-bottom: 0; text-shadow: 0 4px 10px rgba(0,0,0,0.2);">My Cabana ‚õ±Ô∏è</h1>
            <span style="background: rgba(255,255,255,0.3); padding: 5px 15px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; letter-spacing: 1px;">JAN 3 ‚Äî FEB 3</span>
        </div>
        
        <div class="grid" id="challenge-grid"></div>

        <div class="hydration-card">
            <h3 style="margin-top:0; font-size: 1.3rem;">üíß Daily Hydration</h3>
            <div style="font-size: 2.5rem; font-weight: bold; margin: 10px 0;"><span id="water-count">0</span><span style="font-size: 1rem; opacity: 0.7;">/8 glasses</span></div>
            <button onclick="updateWater(1)" style="padding:12px 30px; background:var(--aqua); color:white; border:none; border-radius:15px; font-weight:bold; cursor: pointer;">+ ADD WATER</button>
        </div>
    </div>

    <div id="friends" class="page">
        <h2 style="text-shadow: 0 4px 10px rgba(0,0,0,0.2);">üî• Squad Leaderboard</h2>
        <div id="friends-list"></div>
    </div>

    <div id="videos" class="page">
        <h2 style="text-shadow: 0 4px 10px rgba(0,0,0,0.2);">üì∫ Cabana Cinema</h2>
        <div class="video-card" style="border-color: var(--v1)"><h4>7m Dumbbell Abs</h4><a href="https://youtu.be/89H_mthMBls" target="_blank" style="color:var(--pink); font-weight:bold; text-decoration: none;">START WORKOUT ‚Üí</a></div>
        <div class="video-card" style="border-color: var(--v2)"><h4>10m Lower Abs</h4><a href="https://www.youtube.com/watch?v=xsvLYAplbXw" target="_blank" style="color:var(--pink); font-weight:bold; text-decoration: none;">START WORKOUT ‚Üí</a></div>
        <div class="video-card" style="border-color: var(--v3)"><h4>10m Advanced Abs</h4><a href="https://www.youtube.com/watch?v=kMyMc7t-yDQ" target="_blank" style="color:var(--pink); font-weight:bold; text-decoration: none;">START WORKOUT ‚Üí</a></div>
        <div class="video-card" style="border-color: var(--v4)"><h4>8m Standing Abs</h4><a href="https://www.youtube.com/watch?v=c6UIN0uDOgU" target="_blank" style="color:var(--pink); font-weight:bold; text-decoration: none;">START WORKOUT ‚Üí</a></div>
    </div>

    <div class="tab-bar">
        <button class="tab-btn active" onclick="showPage('dashboard', this)">HOME üèùÔ∏è</button>
        <button class="tab-btn" onclick="showPage('friends', this)">SQUAD üî•</button>
        <button class="tab-btn" onclick="showPage('videos', this)">VIDEOS üì∫</button>
    </div>

    <div id="overlay" onclick="closeModal()"></div>
    <div id="modal">
        <h2 style="margin-top:0">Log Workout ü••</h2>
        <p>Which vibe did you crush today?</p>
        <select id="video-select" style="width:100%; padding:15px; margin-bottom:20px; border-radius:15px; border: 2px solid #eee; font-size: 1rem;">
            <option value="v1">7m Dumbbell Abs</option>
            <option value="v2">10m Lower Abs</option>
            <option value="v3">10m Advanced Abs</option>
            <option value="v4">8m Standing Abs</option>
        </select>
        <button class="btn" style="background: linear-gradient(to right, var(--coral), var(--pink)); color: white;" onclick="markComplete()">LOG IT & SHINE ‚ú®</button>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCNXn3jKb1xRpHVqZcBy9fEPFjxy_drl_Y",
            authDomain: "core-a-cabana.firebaseapp.com",
            projectId: "core-a-cabana",
            storageBucket: "core-a-cabana.firebasestorage.app",
            messagingSenderId: "914813550096",
            appId: "1:914813550096:web:1fdc8e9486b46f0ad09495",
            measurementId: "G-DBNTD50G8H"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        let myName = localStorage.getItem('cabanaName');
        let myWorkouts = JSON.parse(localStorage.getItem('cabanaWorkouts')) || {};
        let waterCount = parseInt(localStorage.getItem('cabanaWater')) || 0;
        let selectedDay = null;

        if(myName) document.getElementById('join-overlay').style.display = 'none';

        function joinChallenge() {
            const name = document.getElementById('user-name').value.trim();
            if(!name) return;
            myName = name;
            localStorage.setItem('cabanaName', name);
            document.getElementById('join-overlay').style.display = 'none';
            db.collection("players").doc(myName).set({ name: myName, count: 0, lastUpdate: Date.now() });
        }

        function showPage(id, btn) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            btn.classList.add('active');
        }

        function init() {
            const grid = document.getElementById('challenge-grid');
            grid.innerHTML = '';
            for (let i = 0; i < 32; i++) {
                const date = new Date(2026, 0, 3 + i);
                const key = date.toDateString();
                const type = myWorkouts[key];
                const box = document.createElement('div');
                box.className = `day-box ${type ? 'complete ' + type : ''}`;
                box.innerHTML = `
                    <div class="day-num">${date.getDate()}</div>
                    <div style="font-size:0.6rem; opacity:0.8;">JAN</div>
                    <div class="check">üå¥</div>
                `;
                box.onclick = () => { selectedDay = key; document.getElementById('modal').style.display='block'; document.getElementById('overlay').style.display='block'; };
                grid.appendChild(box);
            }
            document.getElementById('water-count').innerText = waterCount;
        }

        function markComplete() {
            const type = document.getElementById('video-select').value;
            myWorkouts[selectedDay] = type;
            localStorage.setItem('cabanaWorkouts', JSON.stringify(myWorkouts));
            const total = Object.keys(myWorkouts).length;
            db.collection("players").doc(myName).set({ 
                name: myName, count: total, lastUpdate: Date.now(), msg: `${myName} just crushed a workout! ü••üî•` 
            }, {merge: true});
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#00e5ff', '#ff7e5f', '#ff4081'] });
            closeModal(); init();
        }

        function updateWater(val) {
            waterCount = Math.max(0, waterCount + val);
            localStorage.setItem('cabanaWater', waterCount);
            if(waterCount === 8) confetti({ particleCount: 100, colors: ['#00e5ff', '#ffffff'] });
            document.getElementById('water-count').innerText = waterCount;
        }

        db.collection("players").orderBy("count", "desc").onSnapshot(snap => {
            const list = document.getElementById('friends-list');
            list.innerHTML = '';
            snap.forEach(doc => {
                const p = doc.data();
                list.innerHTML += `<div class="friend-row"><span>üå¥ <b>${p.name}</b></span><b>${p.count} / 32</b></div>`;
                if(p.name !== myName && Date.now() - p.lastUpdate < 3000) showToast(p.msg);
            });
        });

        function showToast(text) {
            const t = document.getElementById('notification-toast');
            t.innerText = text; t.style.display = 'block';
            setTimeout(() => t.style.display = 'none', 4000);
        }

        function closeModal() { document.getElementById('modal').style.display='none'; document.getElementById('overlay').style.display='none'; }
        
        init();
    </script>
</body>
</html>
